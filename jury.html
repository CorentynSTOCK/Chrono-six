<!DOCTYPE html>
<html>
<head>
  <title>Jury</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 30px; }
    .chrono { font-size: 40px; margin: 20px; }
    button { font-size: 18px; margin: 5px; padding: 10px 20px; }
    input { font-size: 16px; padding: 5px; width: 150px; text-align: center; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>JURY</h1>

  <div>
    <input id="nameA" value="Équipe A" onchange="updateTeamName('A')" />
    <h2><span id="displayA">Équipe A</span> : <span id="chronoA">00:00:00</span></h2>
    <button onclick="start('A')">Démarrer A</button>
    <button onclick="stop('A')">Stop A</button>
    <button onclick="reset('A')">Reset A</button>
  </div>

  <div>
    <input id="nameB" value="Équipe B" onchange="updateTeamName('B')" />
    <h2><span id="displayB">Équipe B</span> : <span id="chronoB">00:00:00</span></h2>
    <button onclick="start('B')">Démarrer B</button>
    <button onclick="stop('B')">Stop B</button>
    <button onclick="reset('B')">Reset B</button>
  </div>

  <button onclick="start('A'); start('B');" style="margin-top:20px;">▶️ Démarrer les 2</button>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBUXyiC63cD3Y1zGy9UaPJ5yMEaDPvC5PE",
      authDomain: "chrono-equipe-v2.firebaseapp.com",
      databaseURL: "https://chrono-equipe-v2-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "chrono-equipe-v2",
      storageBucket: "chrono-equipe-v2.firebasestorage.app",
      messagingSenderId: "962671917095",
      appId: "1:962671917095:web:c6914f49cead3743a93602"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const states = { A: {}, B: {} };

    function start(team) {
      db.ref('chronos/' + team).set({
        startedAt: Date.now(),
        stoppedAt: null
      });
    }

    function stop(team) {
      db.ref('chronos/' + team + '/stoppedAt').set(Date.now());
    }

    function reset(team) {
      db.ref('chronos/' + team).set({
        startedAt: null,
        stoppedAt: null
      });
    }

    function updateChronos() {
      ['A', 'B'].forEach(team => {
        const state = states[team];
        const now = Date.now();
        const end = state.stoppedAt || now;
        const display = document.getElementById("chrono" + team);
        if (!state?.startedAt) {
          display.textContent = "00:00:00";
          return;
        }
        const diff = Math.floor((end - state.startedAt) / 1000);
        const h = String(Math.floor(diff / 3600)).padStart(2, '0');
        const m = String(Math.floor((diff % 3600) / 60)).padStart(2, '0');
        const s = String(diff % 60).padStart(2, '0');
        display.textContent = `${h}:${m}:${s}`;
      });
    }

    function listen(team) {
      db.ref('chronos/' + team).on('value', snap => {
        states[team] = snap.val() || {};
      });
      db.ref('noms/' + team).on('value', snap => {
        const val = snap.val() || "Équipe " + team;
        document.getElementById("display" + team).textContent = val;
        document.getElementById("name" + team).value = val;
      });
    }

    function updateTeamName(team) {
      const name = document.getElementById("name" + team).value;
      db.ref('noms/' + team).set(name);
    }

    listen('A');
    listen('B');
    setInterval(updateChronos, 1000);
  </script>
</body>
</html>
