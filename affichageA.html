<!DOCTYPE html>
<html>
<head>
  <title>Équipe A</title>
  <meta charset="UTF-8">
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <style>
    body {
      background-color: #0044cc;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 50px;
    }
    #logo {
      max-width: 180px;
      margin-bottom: 20px;
    }
    #nom {
      font-size: 40px;
      font-weight: bold;
      margin-bottom: 20px;
    }
    #chrono {
      font-size: 80px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <img id="logo" src="" alt="Logo Équipe A">
  <div id="nom">Équipe A</div>
  <div id="chrono">00:00.000</div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBUXyiC63cD3Y1zGy9UaPJ5yMEaDPvC5PE",
      authDomain: "chrono-equipe-v2.firebaseapp.com",
      databaseURL: "https://chrono-equipe-v2-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "chrono-equipe-v2",
      storageBucket: "chrono-equipe-v2.appspot.com",
      messagingSenderId: "962671917095",
      appId: "1:962671917095:web:c6914f49cead3743a93602"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const equipe = "A";
    const chronoEl = document.getElementById("chrono");
    const logoEl = document.getElementById("logo");
    const nomEl = document.getElementById("nom");

    function updateChrono() {
      db.ref("chronos/" + equipe).on("value", (snap) => {
        const data = snap.val();
        if (!data || !data.startedAt) {
          chronoEl.textContent = "00:00.000";
          return;
        }
        const start = data.startedAt;
        const stop = data.stoppedAt;
        function format(ms) {
          const m = String(Math.floor(ms / 60000)).padStart(2, '0');
          const s = String(Math.floor((ms % 60000) / 1000)).padStart(2, '0');
          const msr = String(ms % 1000).padStart(3, '0');
          return `${m}:${s}.${msr}`;
        }
        if (stop) {
          chronoEl.textContent = format(stop - start);
        } else {
          clearInterval(window._timer);
          window._timer = setInterval(() => {
            chronoEl.textContent = format(Date.now() - start);
          }, 100);
        }
      });
    }

    function updateLogoAndName() {
      db.ref("logos/" + equipe).on("value", snap => {
        const url = snap.val();
        if (url) logoEl.src = url;
      });
      db.ref("noms/" + equipe).on("value", snap => {
        const nom = snap.val();
        if (nom) nomEl.textContent = nom;
      });
    }

    updateChrono();
    updateLogoAndName();
  </script>
</body>
</html>
