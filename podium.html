<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Podium</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <style>
    body {{
      font-family: sans-serif;
      text-align: center;
      background: linear-gradient(to bottom, #e0e0e0, #ffffff);
      margin: 0;
      padding-top: 60px;
    }}
    h1 {{
      font-size: 48px;
      margin-bottom: 40px;
    }}
    .team {{
      font-size: 32px;
      margin: 20px auto;
      padding: 20px;
      width: 60%;
      border-radius: 12px;
      background-color: #f8f9fa;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }}
    .first {{ background-color: gold; }}
    .second {{ background-color: silver; }}
  </style>
</head>
<body>
  <h1>üèÜ Podium</h1>
  <div id="ranking"></div>

  <script>
    const firebaseConfig = {{
      apiKey: "AIzaSyBUXyiC63cD3Y1zGy9UaPJ5yMEaDPvC5PE",
      authDomain: "chrono-equipe-v2.firebaseapp.com",
      databaseURL: "https://chrono-equipe-v2-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "chrono-equipe-v2",
      storageBucket: "chrono-equipe-v2.firebasestorage.app",
      messagingSenderId: "962671917095",
      appId: "1:962671917095:web:c6914f49cead3743a93602"
    }};
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const rankingDiv = document.getElementById("ranking");

    async function loadRanking() {{
      const nomsSnap = await db.ref("noms").once("value");
      const noms = nomsSnap.val();

      const chronosSnap = await db.ref("chronos").once("value");
      const chronos = chronosSnap.val();

      const scores = Object.entries(chronos).map(([team, val]) => {{
        if (!val.startedAt || !val.stoppedAt) return null;
        return {{
          team,
          name: noms[team] || "√âquipe " + team,
          time: val.stoppedAt - val.startedAt
        }};
      }}).filter(Boolean);

      scores.sort((a, b) => a.time - b.time);

      rankingDiv.innerHTML = scores.map((s, i) => `
        <div class="team ${i === 0 ? 'first' : i === 1 ? 'second' : ''}">
          ${i + 1}. <strong>${s.name}</strong> ‚Äî ${formatTime(s.time)}
        </div>
      `).join('');
    }}

    function formatTime(ms) {{
      const minutes = String(Math.floor(ms / 60000)).padStart(2, '0');
      const seconds = String(Math.floor((ms % 60000) / 1000)).padStart(2, '0');
      const millis = String(ms % 1000).padStart(3, '0');
      return `${{minutes}}:${{seconds}}.${{millis}}`;
    }}

    loadRanking();
  </script>
</body>
</html>
